define ("block_point_view/script_point_view",["jquery","core/ajax","core/notification"],function(a,b,c){return{init:function init(d){a(function(){var e=parseInt(d.userid),f=d.courseid,g=d.contextid,h=b.call([{methodname:"block_point_view_get_database",args:{userid:e,courseid:f},fail:c.exception},{methodname:"block_point_view_get_pixparam",args:{courseid:f,contextid:g},fail:c.exception},{methodname:"block_point_view_get_moduleselect",args:{courseid:f},fail:c.exception},{methodname:"block_point_view_get_difficulty_levels",args:{courseid:f},fail:c.exception},{methodname:"block_point_view_get_track_colors",args:{},fail:c.exception},{methodname:"block_point_view_get_enrol_list",args:{userid:e},fail:c.exception}]);a.when(h[0],h[1],h[2],h[3],h[4],h[5]).done(function(d,g,h,i,j,k){var x=d,y=g,z=j,A=h,B={NULL:0,EASY:1,BETTER:2,HARD:3},C={},D={},E={},F={},G={};A.forEach(function(a){var b=parseInt(a);C[b]=!1;D[b]=null;E[b]=null;F[b]=null;G[b]=null});function l(b,c){var d=parseInt(b.getElementsByClassName("easy_nb")[0].innerText),e=parseInt(b.getElementsByClassName("better_nb")[0].innerText),f=parseInt(b.getElementsByClassName("hard_nb")[0].innerText),g="group_";if(d){g+="E"}if(e){g+="B"}if(f){g+="H"}if(null!==D[c]&&D[c]!==B.NULL){var h=a("#module-"+c+" .group_nb");h.addClass("voted");if(10<=E[c]){h.css({"font-size":"10px"})}}else{a("#module-"+c+" .group_nb").removeClass("voted")}a("#module-"+c+" .group_img").attr("src",y[g])}function m(){var d=b.call([{methodname:"block_point_view_get_database",args:{userid:e,courseid:f},fail:c.exception}]);a.when(d[0]).done(function(a){x=a})}function n(a){var b=!1,c;m();x.forEach(function(d){if(parseInt(d.cmid)===a){c=d;b=!0}});if(!b){c={cmid:a.toString(),courseid:f,total:"0",typeone:"0",typetwo:"0",typethree:"0",uservote:"0"}}return c}function o(b){a(this).stop();a(this).css({cursor:"pointer"});a(this).animate({top:-1.5,left:-3,height:23},100);G[b.data.moduleId]=setTimeout(function(){if(0===parseInt(b.data.module.getElementsByClassName("easy_nb")[0].innerText)){a("#module-"+b.data.moduleId+" .easy").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"})}if(0===parseInt(b.data.module.getElementsByClassName("better_nb")[0].innerText)){a("#module-"+b.data.moduleId+" .better").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"})}if(0===parseInt(b.data.module.getElementsByClassName("hard_nb")[0].innerText)){a("#module-"+b.data.moduleId+" .hard").css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"})}a("#module-"+b.data.moduleId+" .group_img").animate({top:"+=15",left:"+=35",height:0},300).hide(0);a("#module-"+b.data.moduleId+" .group_nb").delay(50).hide(300);a("#module-"+b.data.moduleId+" .actions").hide(300);a("#module-"+b.data.moduleId+" .easy").delay(50).animate({top:-15,left:-20,height:20},300).css({"pointer-events":"auto"});a("#module-"+b.data.moduleId+" .easy_nb").delay(50).show(300);a("#module-"+b.data.moduleId+" .better").delay(200).animate({top:-15,left:25,height:20},300).css({"pointer-events":"auto"});a("#module-"+b.data.moduleId+" .better_nb").delay(200).show(300);a("#module-"+b.data.moduleId+" .hard").delay(400).animate({top:-15,left:70,height:20},300).css({"pointer-events":"auto"});a("#module-"+b.data.moduleId+" .hard_nb").delay(400).show(300)},500);clearTimeout(F[b.data.moduleId]);F[b.data.moduleId]=setTimeout(function(){if(!C[b.data.moduleId]){a("#module-"+b.data.moduleId+" .hard").css({"pointer-events":"none"}).delay(50).animate({top:-7.5,left:80,height:0},500);a("#module-"+b.data.moduleId+" .hard_nb").delay(50).hide(300);a("#module-"+b.data.moduleId+" .better").css({"pointer-events":"none"}).delay(300).animate({top:-7.5,left:35,height:0},500);a("#module-"+b.data.moduleId+" .better_nb").delay(300).hide(300);a("#module-"+b.data.moduleId+" .easy").css({"pointer-events":"none"}).delay(600).animate({top:-7.5,left:-10,height:0},500);a("#module-"+b.data.moduleId+" .easy_nb").delay(600).hide(300);l(b.data.module,b.data.moduleId);a("#module-"+b.data.moduleId+" .group_img").show(0).delay(500).animate({top:0,left:0,height:20},300);if(0!==parseInt(b.data.module.getElementsByClassName("group_nb")[0].innerText)){a("#module-"+b.data.moduleId+" .group_nb").delay(600).show(300)}a("#module-"+b.data.moduleId+" .actions").delay(600).show(300)}},2e3)}function p(b){a(this).stop();clearTimeout(G[b.data.moduleId]);if("0px"===a("#module-"+b.data.moduleId+" .easy").css("height")){a(this).animate({top:0,left:0,height:20},100)}}function q(b){a(this).stop();var c=a("#module-"+b.data.moduleId+" ."+b.data.reactionName+"_txt").width(),d=b.data.leftReaction-c/2-10;a("#module-"+b.data.moduleId+" ."+b.data.reactionName+"_txt").css({"-webkit-transform":"translateX("+d+"px)","-moz-transform":"translateX("+d+"px)","-ms-transform":"translateX("+d+"px)",transform:"translateX("+d+"px)"});var e=parseInt(b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText);if(0===e){a("#module-"+b.data.moduleId+" ."+b.data.reactionName).css({"-webkit-filter":"",filter:""})}a(this).css({cursor:"pointer"});a(this).animate({top:-25,left:b.data.leftReaction,height:40},100)}function r(b){a(this).stop();a(this).animate({top:-15,left:b.data.leftReaction,height:20},100);var c=parseInt(b.data.module.getElementsByClassName(b.data.reactionName+"_nb")[0].innerText);if(0===c){a("#module-"+b.data.moduleId+" ."+b.data.reactionName).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"})}}function s(d){var g=1!==f?!0:k.ids.includes(d.data.moduleId.toString(10));if(g){if(null!==e&&1!==e){var h=parseInt(d.data.module.getElementsByClassName(d.data.reactionName+"_nb")[0].innerText);E[d.data.moduleId]=parseInt(d.data.module.getElementsByClassName("group_nb")[0].innerText);if(0===h){a("#module-"+d.data.moduleId+" ."+d.data.reactionName).css({"-webkit-filter":"",filter:""})}if(D[d.data.moduleId]===B.NULL){b.call([{methodname:"block_point_view_update_db",args:{func:"insert",userid:e,courseid:f,cmid:d.data.moduleId,vote:d.data.reactionSelect},done:function done(){a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").text(h+1);a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").css({"font-weight":"bold",color:"#5585B6"});d.data.module.getElementsByClassName("group_nb")[0].innerText=E[d.data.moduleId]+1;D[d.data.moduleId]=d.data.reactionSelect},fail:c.exception}])}else if(D[d.data.moduleId]===d.data.reactionSelect){b.call([{methodname:"block_point_view_update_db",args:{func:"remove",userid:e,courseid:f,cmid:d.data.moduleId,vote:d.data.reactionSelect},done:function done(){h--;a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").text(h);a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").css({"font-weight":"normal",color:"black"});if(0===h){a("#module-"+d.data.moduleId+" ."+d.data.reactionName).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"})}d.data.module.getElementsByClassName("group_nb")[0].innerText=E[d.data.moduleId]-1;D[d.data.moduleId]=B.NULL},fail:c.exception}])}else{b.call([{methodname:"block_point_view_update_db",args:{func:"update",userid:e,courseid:f,cmid:d.data.moduleId,vote:d.data.reactionSelect},done:function done(){a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").text(h+1);a("#module-"+d.data.moduleId+" ."+d.data.reactionName+"_nb").css({"font-weight":"bold",color:"#5585B6"});var b;switch(D[d.data.moduleId]){case B.EASY:b="easy";break;case B.BETTER:b="better";break;case B.HARD:b="hard";break;}var c=parseInt(d.data.module.getElementsByClassName(b+"_nb")[0].innerText)-1;a("#module-"+d.data.moduleId+" ."+b+"_nb").text(c);a("#module-"+d.data.moduleId+" ."+b+"_nb").css({"font-weight":"normal",color:"black"});if(0==c){a("#module-"+d.data.moduleId+" ."+b).css({"-webkit-filter":"grayscale(100%)",filter:"grayscale(100%)"})}D[d.data.moduleId]=d.data.reactionSelect},fail:c.exception}])}}}}function t(a){C[a.data.moduleId]=!0}function u(b){C[b.data.moduleId]=!1;clearTimeout(F[b.data.moduleId]);F[b.data.moduleId]=setTimeout(function(){if(!C[b.data.moduleId]){a("#module-"+b.data.moduleId+" .hard").css({"pointer-events":"none"}).delay(50).animate({top:-7.5,left:80,height:0},500);a("#module-"+b.data.moduleId+" .hard_nb").delay(50).hide(300);a("#module-"+b.data.moduleId+" .better").css({"pointer-events":"none"}).delay(300).animate({top:-7.5,left:35,height:0},500);a("#module-"+b.data.moduleId+" .better_nb").delay(300).hide(300);a("#module-"+b.data.moduleId+" .easy").css({"pointer-events":"none"}).delay(600).animate({top:-7.5,left:-10,height:0},500);a("#module-"+b.data.moduleId+" .easy_nb").delay(600).hide(300);l(b.data.module,b.data.moduleId);a("#module-"+b.data.moduleId+" .group_img").delay(500).show(0).animate({top:0,left:0,height:20},300);if(0!==parseInt(b.data.module.getElementsByClassName("group_nb")[0].innerText)){a("#module-"+b.data.moduleId+" .group_nb").delay(600).show(300)}a("#module-"+b.data.moduleId+" .actions").delay(600).show(300)}},1e3)}a(".activity").not(".label").mouseover(function(){a(this).css({background:"linear-gradient(to right, #f4f4f4, #f4f4f4, white)","border-radius":"5px"})}).mouseout(function(){a(this).css({background:""})});v();a(document).ajaxComplete(function(a,b,c){if(c.data!==void 0){var d=JSON.parse(c.data);if(0<d.length&&d[0].methodname!==void 0){var e=d[0].methodname;if("format_tiles_get_single_section_page_html"===e||"format_tiles_log_tile_click"===e){v()}}}});function v(){a(".mod-indent-outer").css({width:"85%"});a(".folder .mod-indent-outer").each(function(b,c){if(0<!a(c).find(".activityinstance").length){a(c).prepend("<div class=\"activityinstance\" style=\"width: 0;\"><a></a></div>")}});A.forEach(function(b){var c=parseInt(b),d=n(c),e="<div class=\"block_point_view block_point_view_container\"><div class=\"reactions\"><!-- EASY ! --><span class=\"tooltipreaction\"><img src=\""+y.easy+"\" alt=\" \" class=\"easy\"/><span class=\"tooltiptextreaction easy_txt\">"+y.easytxt+"</span></span><span class=\"easy_nb\">"+d.typeone+"</span><!-- I'M GETTING BETTER --><span class=\"tooltipreaction\"><img src=\""+y.better+"\" alt=\" \" class=\"better\"/><span class=\"tooltiptextreaction better_txt\">"+y.bettertxt+"</span></span><span class=\"better_nb\">"+d.typetwo+"</span><!-- SO HARD... --><span class=\"tooltipreaction\"><img src=\""+y.hard+"\" alt=\" \" class=\"hard\"/><span class=\"tooltiptextreaction hard_txt\">"+y.hardtxt+"</span></span><span class=\"hard_nb\">"+d.typethree+"</span></div><!-- GROUP --><div class=\"group\"><img src=\"\" alt=\" \" class=\"group_img\"/><span class=\"group_nb\">"+d.total+"</span></div></div>";if(null!==document.getElementById("module-"+c)&&0===document.querySelectorAll("#module-"+c+" .block_point_view_container").length){a("#module-"+c+" .activityinstance").append(e);w(c,"#module-")}switch(parseInt(d.uservote)){case 1:D[c]=B.EASY;a("#module-"+c+" .easy_nb").css({"font-weight":"bold",color:"#5585B6"});break;case 2:D[c]=B.BETTER;a("#module-"+c+" .better_nb").css({"font-weight":"bold",color:"#5585B6"});break;case 3:D[c]=B.HARD;a("#module-"+c+" .hard_nb").css({"font-weight":"bold",color:"#5585B6"});break;default:D[c]=B.NULL;break;}var f=document.getElementById("module-"+c);if(null!==f){l(f,c)}})}function w(b,c){var d=parseInt(b),e=document.getElementById("module-"+d);if(null!==e){if(0===parseInt(e.getElementsByClassName("group_nb")[0].innerText)){a(c+d+" .group_nb").hide()}l(e,d);a(c+d+" .group_img").mouseover({module:e,moduleId:d},o).click({module:e,moduleId:d},o).mouseout({moduleId:d},p);a(c+d+" .easy").mouseover({module:e,moduleId:d,reactionName:"easy",className:"easy_txt",leftReaction:-30},q).mouseout({module:e,moduleId:d,leftReaction:-20,reactionName:"easy"},r).click({module:e,moduleId:d,reactionName:"easy",reactionSelect:B.EASY},s);a(c+d+" .better").mouseover({module:e,moduleId:d,reactionName:"better",className:"better_txt",leftReaction:15},q).mouseout({module:e,moduleId:d,leftReaction:25,reactionName:"better"},r).click({module:e,moduleId:d,reactionName:"better",reactionSelect:B.BETTER},s);var f=a(c+d+" .hard"),g=parseInt(f.css("left").slice(0,-2),10);f.mouseover({module:e,moduleId:d,reactionName:"hard",className:"hard_txt",leftReaction:g-20},q).mouseout({module:e,moduleId:d,leftReaction:g-10,reactionName:"hard"},r).click({module:e,moduleId:d,reactionName:"hard",reactionSelect:B.HARD},s);a(c+d+" .reactions").mouseover({moduleId:d},t).mouseout({module:e,moduleId:d},u)}}i.forEach(function(b){var c=1===f?" .difficulty_box":" .activityinstance a";if("0"!==b.difficultyLevel){var d;switch(parseInt(b.difficultyLevel)){case 1:d="green";break;case 2:d="blue";break;case 3:d="red";break;case 4:d="black";break;}var e="<div class=\"block_point_view track "+d+"track\"></div>";a("#module-"+b.id+c).prepend(e)}else{a("#module-"+b.id+c).prepend("<span class=\"block_point_view track\"></span>")}});a("#region-main > .card").css({"overflow-x":"unset"});a(".greentrack").css({"background-color":z.greentrack});a(".bluetrack").css({"background-color":z.bluetrack});a(".redtrack").css({"background-color":z.redtrack});a(".blacktrack").css({"background-color":z.blacktrack});a(".block_point_view #menu_point_view_img").mouseover(function(){a(this).css({"-webkit-filter":"invert(100%)","-moz-filter":"invert(100%)","-o-filter":"invert(100%)","-ms-filter":"invert(100%)"})}).mouseout(function(){a(this).css({"-webkit-filter":"invert(0%)","-moz-filter":"invert(0%)","-o-filter":"invert(0%)","-ms-filter":"invert(0%)"})})})})}}});
//# sourceMappingURL=script_point_view.min.js.map
