M.core_rating={Y:null,api:M.cfg.wwwroot+'/rating/rate_ajax.php',init:function(Y){this.Y=Y;Y.all('select.postratingmenu').each(this.attach_rating_events,this);this.Y.all('input.postratingmenusubmit').setStyle('display','none')},attach_rating_events:function(selectnode){selectnode.on('change',this.submit_rating,this,selectnode)},submit_rating:function(e,selectnode){var theinputs=selectnode.ancestor('form').all('.ratinginput');var thedata=[];var inputssize=theinputs.size();for(var i=0;i<inputssize;i++){if(theinputs.item(i).get("name")!="returnurl"){thedata[theinputs.item(i).get("name")]=theinputs.item(i).get("value")}}
var scope=this;var cfg={method:'POST',on:{complete:function(tid,outcome,args){try{if(!outcome){alert('IO FATAL');return!1}
var data=scope.Y.JSON.parse(outcome.responseText);if(data.success){if(data.itemid){var itemid=data.itemid;var node=scope.Y.one('#ratingaggregate'+itemid);node.set('innerHTML',data.aggregate);var node=scope.Y.one('#ratingcount'+itemid);if(data.count>0){node.set('innerHTML',"("+data.count+")")}else{node.set('innerHTML',"")}}
return!0}else if(data.error){alert(data.error)}}catch(e){alert(e.message+" "+outcome.responseText)}
return!1}},arguments:{scope:scope},headers:{},data:build_querystring(thedata)};this.Y.io(this.api,cfg)}}